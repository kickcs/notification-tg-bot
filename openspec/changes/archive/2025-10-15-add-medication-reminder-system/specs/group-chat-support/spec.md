# Spec Delta: Group Chat Support

## ADDED Requirements

### Requirement: Работа бота в группах Telegram
Бот MUST корректно функционировать при добавлении в группы Telegram.

#### Scenario: Добавление бота в группу
- **WHEN** бот добавляется в группу
- **THEN** бот может читать сообщения в группе
- **AND** может отвечать на команды
- **AND** может отправлять сообщения в группу

#### Scenario: Обработка команд в группе
- **WHEN** пользователь отправляет команду в группе
- **THEN** бот обрабатывает команду
- **AND** отправляет ответ в ту же группу
- **AND** сохраняет chatId группы для будущих сообщений

### Requirement: Идентификация пользователя в группе
Система MUST корректно идентифицировать пользователя в контексте группы.

#### Scenario: Сохранение userId и chatId
- **WHEN** пользователь создает расписание в группе
- **THEN** система сохраняет telegramId пользователя
- **AND** сохраняет chatId группы
- **AND** связывает расписание с обоими идентификаторами

#### Scenario: Разные пользователи в одной группе
- **WHEN** несколько пользователей создают расписания в одной группе
- **THEN** каждое расписание привязано к своему пользователю
- **AND** напоминания отправляются правильному пользователю
- **AND** подтверждения обрабатываются индивидуально

### Requirement: Отправка напоминаний в группу
Система MUST отправлять напоминания в правильную группу для каждого пользователя.

#### Scenario: Целевая группа для напоминания
- **WHEN** наступает время напоминания
- **THEN** система использует chatId из расписания
- **AND** отправляет сообщение именно в эту группу
- **AND** упоминает пользователя в сообщении (опционально)

#### Scenario: Пользователь в нескольких группах
- **WHEN** пользователь состоит в нескольких группах с ботом
- **AND** имеет расписания в разных группах
- **THEN** каждое напоминание отправляется в соответствующую группу
- **AND** расписания не пересекаются между группами

### Requirement: Обработка callback-кнопок в группе
Система MUST корректно обрабатывать нажатия inline-кнопок в групповых чатах.

#### Scenario: Подтверждение в группе
- **WHEN** пользователь нажимает кнопку "Подтвердить" в группе
- **THEN** система проверяет что нажавший = получатель напоминания
- **AND** обрабатывает подтверждение
- **AND** отправляет награду в ту же группу

#### Scenario: Защита от чужих подтверждений
- **WHEN** другой пользователь пытается нажать кнопку "Подтвердить"
- **THEN** система проверяет userId нажавшего
- **AND** если userId не совпадает с получателем напоминания
- **THEN** показывает сообщение "Это напоминание не для вас"
- **AND** не засчитывает подтверждение

### Requirement: Обновление информации о группе
Система MUST обновлять информацию о группе при изменениях.

#### Scenario: Изменение названия группы
- **WHEN** название группы изменяется
- **THEN** система продолжает использовать chatId
- **AND** функциональность не нарушается

#### Scenario: Бот удален из группы
- **WHEN** бот удаляется из группы
- **THEN** система не может отправлять сообщения в эту группу
- **AND** расписания остаются в базе данных
- **AND** при повторном добавлении бота расписания можно восстановить
