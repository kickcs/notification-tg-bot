# Spec Delta: Medication Schedule

## ADDED Requirements

### Requirement: Хранение расписания в базе данных
Система MUST хранить расписания приема таблеток с привязкой к пользователю и группе.

#### Scenario: Создание нового расписания
- **WHEN** пользователь создает расписание через команду
- **THEN** система сохраняет запись в таблице Schedule
- **AND** запись содержит userId, chatId, массив времен и статус active
- **AND** запись имеет уникальный идентификатор

#### Scenario: Проверка уникальности расписания
- **WHEN** пользователь пытается создать второе расписание в той же группе
- **THEN** система проверяет наличие активного расписания
- **AND** возвращает ошибку если расписание уже существует

### Requirement: Валидация времени напоминаний
Система MUST валидировать формат времени при создании и редактировании расписания.

#### Scenario: Корректный формат времени
- **WHEN** пользователь указывает время в формате HH:MM (например, 09:00)
- **THEN** система принимает значение
- **AND** сохраняет время в базе данных

#### Scenario: Некорректный формат времени
- **WHEN** пользователь указывает время в неправильном формате (например, 25:00 или 9:0)
- **THEN** система отклоняет значение
- **AND** возвращает сообщение об ошибке с правильным форматом

#### Scenario: Множественные времена
- **WHEN** пользователь указывает несколько времен через запятую (09:00,14:00,21:00)
- **THEN** система валидирует каждое время отдельно
- **AND** сохраняет все корректные значения как массив

### Requirement: Обновление расписания
Система MUST поддерживать изменение существующего расписания.

#### Scenario: Успешное обновление
- **WHEN** пользователь редактирует расписание новыми временами
- **THEN** система обновляет запись в базе данных
- **AND** сохраняет новые времена
- **AND** обновляет поле updatedAt

#### Scenario: Сохранение истории изменений
- **WHEN** расписание обновляется
- **THEN** система сохраняет timestamp последнего изменения
- **AND** позволяет отследить когда было последнее обновление

### Requirement: Удаление расписания
Система MUST поддерживать удаление расписания и связанных данных.

#### Scenario: Мягкое удаление
- **WHEN** пользователь удаляет расписание
- **THEN** система помечает расписание как неактивное (isActive = false)
- **AND** сохраняет историческую запись в базе данных

#### Scenario: Каскадное удаление связанных напоминаний
- **WHEN** расписание удаляется
- **THEN** система также помечает все связанные неподтвержденные напоминания как отмененные
- **AND** сохраняет целостность данных

### Requirement: Привязка к группе
Система MUST связывать каждое расписание с конкретной группой Telegram.

#### Scenario: Сохранение chatId
- **WHEN** пользователь создает расписание в группе
- **THEN** система сохраняет chatId группы
- **AND** использует этот chatId для отправки напоминаний

#### Scenario: Разные расписания в разных группах
- **WHEN** пользователь состоит в нескольких группах с ботом
- **THEN** система позволяет создать отдельное расписание для каждой группы
- **AND** каждое расписание работает независимо
