# Tasks: Система напоминаний о приеме таблеток

## 1. Подготовка базы данных
- [x] 1.1 Обновить Prisma схему: добавить модели Schedule, Reminder, MessageTemplate, Confirmation
- [x] 1.2 Добавить поле chatId в модель User
- [x] 1.3 Создать и применить миграцию
- [x] 1.4 Создать seed-скрипт для базовых шаблонов сообщений
- [x] 1.5 Запустить seed для добавления дефолтных шаблонов

## 2. Установка зависимостей
- [x] 2.1 Добавить node-cron в package.json
- [x] 2.2 Установить зависимости через yarn

## 3. Утилиты и сервисы
- [x] 3.1 Создать src/utils/timeUtils.ts для работы со временем
- [x] 3.2 Создать src/services/templateService.ts для работы с шаблонами
- [x] 3.3 Создать src/services/scheduleService.ts для управления расписаниями
- [x] 3.4 Создать src/services/reminderService.ts для работы с напоминаниями

## 4. Планировщик задач
- [x] 4.1 Создать src/scheduler/cronScheduler.ts
- [x] 4.2 Реализовать загрузку расписаний при старте бота
- [x] 4.3 Реализовать регистрацию cron-задач для каждого расписания
- [x] 4.4 Реализовать отправку напоминаний по расписанию
- [x] 4.5 Реализовать механизм повторных напоминаний

## 5. Обработчики команд
- [x] 5.1 Создать src/handlers/commands.ts
- [x] 5.2 Реализовать команду /setreminder для создания расписания
- [x] 5.3 Реализовать команду /myreminders для просмотра расписаний
- [x] 5.4 Реализовать команду /editreminder для редактирования расписания
- [x] 5.5 Реализовать команду /deletereminder для удаления расписания
- [x] 5.6 Реализовать команду /help для справки

## 6. Обработчики callback-кнопок
- [x] 6.1 Создать src/handlers/callbacks.ts
- [x] 6.2 Реализовать обработчик подтверждения приема таблеток
- [x] 6.3 Реализовать отправку сообщения-награды после подтверждения
- [x] 6.4 Реализовать обработку отмены повторных напоминаний

## 7. Поддержка групп
- [x] 7.1 Добавить проверку типа чата (группа/личный чат)
- [x] 7.2 Сохранять chatId при создании расписания
- [x] 7.3 Отправлять напоминания в правильный чат

## 8. Интеграция в основной файл
- [x] 8.1 Обновить src/index.ts: подключить новые обработчики
- [x] 8.2 Инициализировать планировщик при старте бота
- [x] 8.3 Корректно останавливать планировщик при завершении
- [x] 8.4 Обновить команду /start для работы в группах

## 9. Документация
- [x] 9.1 Обновить README.md с описанием новых команд
- [x] 9.2 Добавить примеры использования
- [x] 9.3 Документировать формат времени и расписания

## 10. Тестирование
- [x] 10.1 Протестировать создание расписания в группе
- [x] 10.2 Протестировать отправку напоминаний по времени
- [x] 10.3 Протестировать подтверждение и получение награды
- [x] 10.4 Протестировать повторные напоминания
- [x] 10.5 Протестировать редактирование и удаление расписания
- [x] 10.6 Протестировать восстановление расписаний после перезапуска
