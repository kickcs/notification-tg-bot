## ADDED Requirements

### Requirement: Команда создания квиза
Бот MUST предоставлять администратору команду для создания нового квиза с уникальным названием.

#### Scenario: Успешное создание квиза
- **WHEN** администратор отправляет команду `/createquiz Медицина`
- **THEN** бот создает новый квиз с названием "Медицина"
- **AND** бот сохраняет квиз в базе данных как активный
- **AND** бот отправляет подтверждение "Квиз 'Медицина' создан. Добавьте вопросы с помощью /addquestion Медицина"

#### Scenario: Попытка создать квиз с существующим названием
- **WHEN** администратор отправляет команду `/createquiz Медицина`
- **AND** квиз с названием "Медицина" уже существует
- **THEN** бот отправляет сообщение "Квиз с названием 'Медицина' уже существует"
- **AND** новый квиз не создается

#### Scenario: Создание квиза без указания названия
- **WHEN** администратор отправляет команду `/createquiz` без параметров
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/createquiz <название>"

#### Scenario: Попытка использования команды не администратором
- **WHEN** обычный пользователь отправляет команду `/createquiz Тест`
- **THEN** бот отправляет сообщение "У вас нет прав для выполнения этой команды"
- **AND** квиз не создается

### Requirement: Команда просмотра всех квизов
Бот MUST предоставлять команду для просмотра списка всех доступных квизов.

#### Scenario: Просмотр списка квизов пользователем
- **WHEN** пользователь отправляет команду `/listquizzes`
- **THEN** бот отправляет список всех активных квизов с их названиями
- **AND** для каждого квиза показывает количество вопросов
- **AND** бот показывает общее количество квизов

#### Scenario: Просмотр когда нет квизов
- **WHEN** пользователь отправляет команду `/listquizzes`
- **AND** в базе данных нет квизов
- **THEN** бот отправляет сообщение "Квизы не найдены"

#### Scenario: Просмотр списка квизов администратором
- **WHEN** администратор отправляет команду `/listquizzes`
- **THEN** бот отправляет список всех квизов включая неактивные
- **AND** показывает статус каждого квиза (активный/неактивный)

### Requirement: Административная команда удаления квиза
Бот MUST предоставлять администратору команду для удаления квиза со всеми его вопросами.

#### Scenario: Успешное удаление квиза
- **WHEN** администратор отправляет команду `/deletequiz Медицина`
- **AND** квиз с названием "Медицина" существует
- **THEN** бот удаляет квиз и все связанные вопросы из базы данных
- **AND** бот отправляет подтверждение "Квиз 'Медицина' удален вместе с N вопросами"

#### Scenario: Удаление несуществующего квиза
- **WHEN** администратор отправляет команду `/deletequiz Несуществующий`
- **AND** квиз с указанным названием не существует
- **THEN** бот отправляет сообщение "Квиз 'Несуществующий' не найден"
- **AND** операция не выполняется

#### Scenario: Попытка удаления без указания названия
- **WHEN** администратор отправляет команду `/deletequiz` без параметров
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/deletequiz <название>"

### Requirement: Команда запуска квиза по названию
Бот MUST предоставлять команду для запуска квиза по его названию.

#### Scenario: Успешный запуск квиза
- **WHEN** пользователь отправляет команду `/startquiz Медицина`
- **AND** квиз "Медицина" существует и содержит вопросы
- **THEN** бот загружает все вопросы квиза в случайном порядке
- **AND** бот создает временную сессию квиза
- **AND** бот отправляет первый вопрос с вариантами ответов в виде inline-кнопок
- **AND** сессия сохраняется в памяти с привязкой к пользователю и чату

#### Scenario: Запуск несуществующего квиза
- **WHEN** пользователь отправляет команду `/startquiz Несуществующий`
- **AND** квиз с таким названием не существует
- **THEN** бот отправляет сообщение "Квиз 'Несуществующий' не найден"
- **AND** бот предлагает использовать `/listquizzes` для просмотра доступных квизов

#### Scenario: Запуск квиза без вопросов
- **WHEN** пользователь отправляет команду `/startquiz Медицина`
- **AND** квиз "Медицина" существует но не содержит вопросов
- **THEN** бот отправляет сообщение "Квиз 'Медицина' пока не содержит вопросов"
- **AND** квиз не запускается

#### Scenario: Запуск квиза без указания названия
- **WHEN** пользователь отправляет команду `/startquiz` без параметров
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/startquiz <название>"
- **AND** бот предлагает использовать `/listquizzes` для просмотра доступных квизов

#### Scenario: Попытка запустить квиз при активной сессии
- **WHEN** пользователь отправляет команду `/startquiz История`
- **AND** у пользователя уже есть активная сессия квиза
- **THEN** бот отправляет сообщение "У вас уже есть активный квиз. Завершите его или используйте /cancelquiz"
- **AND** новая сессия не создается

### Requirement: Обработка ответов на вопросы квиза
Бот MUST обрабатывать ответы пользователя через inline-кнопки и предоставлять немедленную обратную связь.

#### Scenario: Правильный ответ на вопрос
- **WHEN** пользователь нажимает кнопку с правильным ответом
- **THEN** бот обновляет сообщение с вопросом, добавляя индикатор "✅ Правильно!"
- **AND** бот увеличивает счетчик правильных ответов в сессии
- **AND** бот отправляет следующий вопрос с новыми вариантами ответов
- **AND** предыдущие кнопки становятся неактивными

#### Scenario: Неправильный ответ на вопрос
- **WHEN** пользователь нажимает кнопку с неправильным ответом
- **THEN** бот обновляет сообщение с вопросом, добавляя индикатор "❌ Неправильно!"
- **AND** бот показывает правильный ответ
- **AND** бот увеличивает счетчик неправильных ответов в сессии
- **AND** бот отправляет следующий вопрос с новыми вариантами ответов

#### Scenario: Ответ на последний вопрос квиза
- **WHEN** пользователь отвечает на последний вопрос в квизе
- **THEN** бот обновляет сообщение с индикатором правильности ответа
- **AND** бот отправляет финальную статистику прохождения
- **AND** бот удаляет сессию квиза из памяти

#### Scenario: Попытка ответить на чужой квиз
- **WHEN** пользователь нажимает кнопку ответа в квизе другого пользователя
- **THEN** бот отправляет callback alert "Это не ваш квиз"
- **AND** ответ не засчитывается
- **AND** состояние квиза не изменяется

### Requirement: Отображение финальной статистики квиза
Бот MUST показывать детальную статистику прохождения квиза после завершения всех вопросов.

#### Scenario: Завершение квиза с хорошим результатом
- **WHEN** пользователь завершает квиз с 8 правильными ответами из 10
- **THEN** бот отправляет сообщение с заголовком "🎉 Квиз завершен!"
- **AND** бот показывает количество правильных ответов "✅ Правильно: 8"
- **AND** бот показывает количество неправильных ответов "❌ Неправильно: 2"
- **AND** бот показывает процент правильных ответов "📊 Результат: 80%"
- **AND** бот добавляет поздравительное сообщение "Отличный результат!"

#### Scenario: Завершение квиза с плохим результатом
- **WHEN** пользователь завершает квиз с 2 правильными ответами из 10
- **THEN** бот отправляет статистику с результатом 20%
- **AND** бот добавляет ободряющее сообщение "Попробуйте еще раз!"

#### Scenario: Завершение квиза с идеальным результатом
- **WHEN** пользователь завершает квиз со всеми правильными ответами
- **THEN** бот отправляет статистику с результатом 100%
- **AND** бот добавляет специальное сообщение "🏆 Идеально! Все ответы верны!"

### Requirement: Команда отмены активного квиза
Бот MUST предоставлять команду для досрочного завершения активной сессии квиза.

#### Scenario: Отмена активного квиза
- **WHEN** пользователь отправляет команду `/cancelquiz`
- **AND** у пользователя есть активная сессия квиза
- **THEN** бот удаляет сессию из памяти
- **AND** бот отправляет сообщение "Квиз отменен. Вы можете начать новый с помощью /startquiz"

#### Scenario: Попытка отмены без активного квиза
- **WHEN** пользователь отправляет команду `/cancelquiz`
- **AND** у пользователя нет активной сессии квиза
- **THEN** бот отправляет сообщение "У вас нет активного квиза"

### Requirement: Административная команда добавления вопроса в квиз
Бот MUST предоставлять администратору команду для добавления новых вопросов в конкретный квиз с вариантами ответов.

#### Scenario: Начало процесса добавления вопроса
- **WHEN** администратор отправляет команду `/addquestion Медицина`
- **AND** квиз "Медицина" существует
- **THEN** бот создает временное состояние для диалога добавления вопроса
- **AND** бот сохраняет название квиза "Медицина" в состояние
- **AND** бот отправляет сообщение "Отправьте текст вопроса для квиза 'Медицина'"
- **AND** бот ожидает следующее сообщение от администратора

#### Scenario: Попытка добавить вопрос в несуществующий квиз
- **WHEN** администратор отправляет команду `/addquestion Несуществующий`
- **AND** квиз с таким названием не существует
- **THEN** бот отправляет сообщение "Квиз 'Несуществующий' не найден"
- **AND** диалог не начинается

#### Scenario: Добавление вопроса без указания квиза
- **WHEN** администратор отправляет команду `/addquestion` без параметров
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/addquestion <название_квиза>"

#### Scenario: Ввод текста вопроса
- **WHEN** администратор в состоянии добавления вопроса отправляет текст "Столица России?"
- **THEN** бот сохраняет текст вопроса во временное состояние
- **AND** бот отправляет сообщение "Отправьте вариант ответа 1 (всего нужно 4 варианта)"
- **AND** бот переходит в состояние ожидания вариантов ответов

#### Scenario: Ввод всех вариантов ответов
- **WHEN** администратор последовательно отправляет 4 варианта ответа
- **THEN** бот сохраняет каждый вариант во временное состояние
- **AND** после четвертого варианта бот отправляет список вариантов с номерами
- **AND** бот запрашивает "Введите номер правильного ответа (1-4)"

#### Scenario: Указание правильного ответа и сохранение
- **WHEN** администратор отправляет номер правильного ответа "2"
- **THEN** бот создает вопрос в базе данных с текстом и вариантами
- **AND** бот связывает вопрос с квизом "Медицина"
- **AND** бот помечает второй вариант как правильный
- **AND** бот отправляет подтверждение "Вопрос добавлен в квиз 'Медицина'. Всего вопросов: N"
- **AND** бот очищает временное состояние диалога

#### Scenario: Отмена процесса добавления вопроса
- **WHEN** администратор в процессе добавления вопроса отправляет "/cancel"
- **THEN** бот очищает временное состояние диалога
- **AND** бот отправляет сообщение "Добавление вопроса отменено"

#### Scenario: Попытка использования команды не администратором
- **WHEN** обычный пользователь отправляет команду `/addquestion Медицина`
- **THEN** бот отправляет сообщение "У вас нет прав для выполнения этой команды"
- **AND** диалог не начинается

### Requirement: Административная команда просмотра вопросов квиза
Бот MUST предоставлять администратору команду для просмотра всех вопросов конкретного квиза.

#### Scenario: Просмотр вопросов квиза
- **WHEN** администратор отправляет команду `/listquestions Медицина`
- **AND** квиз "Медицина" существует и содержит вопросы
- **THEN** бот получает все вопросы квиза из базы данных
- **AND** бот отправляет список вопросов с их ID и текстом
- **AND** для каждого вопроса показывает варианты ответов
- **AND** бот показывает общее количество вопросов в конце списка

#### Scenario: Просмотр вопросов несуществующего квиза
- **WHEN** администратор отправляет команду `/listquestions Несуществующий`
- **AND** квиз с таким названием не существует
- **THEN** бот отправляет сообщение "Квиз 'Несуществующий' не найден"

#### Scenario: Просмотр когда в квизе нет вопросов
- **WHEN** администратор отправляет команду `/listquestions Медицина`
- **AND** квиз "Медицина" существует но не содержит вопросов
- **THEN** бот отправляет сообщение "В квизе 'Медицина' пока нет вопросов. Добавьте вопросы с помощью /addquestion Медицина"

#### Scenario: Просмотр без указания квиза
- **WHEN** администратор отправляет команду `/listquestions` без параметров
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/listquestions <название_квиза>"

#### Scenario: Просмотр с большим количеством вопросов
- **WHEN** администратор отправляет команду `/listquestions Медицина`
- **AND** в квизе более 20 вопросов
- **THEN** бот отправляет первые 20 вопросов
- **AND** бот добавляет сообщение "Показано 20 из X вопросов"

### Requirement: Административная команда удаления вопроса
Бот MUST предоставлять администратору команду для удаления вопросов из базы данных.

#### Scenario: Успешное удаление вопроса
- **WHEN** администратор отправляет команду `/deletequestion abc-123-def`
- **AND** вопрос с указанным ID существует
- **THEN** бот удаляет вопрос и все связанные варианты ответов из базы данных
- **AND** бот отправляет подтверждение "Вопрос удален: [текст вопроса]"

#### Scenario: Удаление несуществующего вопроса
- **WHEN** администратор отправляет команду `/deletequestion invalid-id`
- **AND** вопрос с указанным ID не существует
- **THEN** бот отправляет сообщение "Вопрос не найден"
- **AND** операция не выполняется

#### Scenario: Попытка удаления без указания ID
- **WHEN** администратор отправляет команду `/deletequestion` без ID
- **THEN** бот отправляет сообщение об ошибке с объяснением формата команды
- **AND** бот показывает пример использования "/deletequestion <id>"

## MODIFIED Requirements

### Requirement: Обновленная справка с админскими командами
Бот MUST отображать команды администратора в справке только для пользователей с правами администратора.

#### Scenario: Справка для администратора
- **WHEN** администратор отправляет команду `/help`
- **THEN** бот отправляет список всех команд включая административные
- **AND** административные команды помечены специальным маркером
- **AND** показывает формат и примеры использования админских команд
- **AND** включает команды `/setstatus` и `/clearstatus` для управления статусами пользователей
- **AND** включает команды `/addquestion`, `/listquestions`, `/deletequestion` для управления квизом

#### Scenario: Справка для обычного пользователя
- **WHEN** обычный пользователь отправляет команду `/help`
- **THEN** бот отправляет список только пользовательских команд
- **AND** административные команды не отображаются
- **AND** включает команды `/startquiz` и `/cancelquiz` для квиз-викторины
