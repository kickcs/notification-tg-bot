## Context
Текущая система использует шаблоны сообщений из базы данных для напоминаний и наград. Управление этими шаблонами возможно только через прямой доступ к БД или seed-скрипты. Необходимо предоставить администратору возможность управлять шаблонами через команды бота.

## Goals / Non-Goals
**Goals:**
- Добавить административные команды для CRUD операций с шаблонами
- Реализовать простую авторизацию через Telegram ID
- Сохранить существующую функциональность случайного выбора шаблонов

**Non-Goals:**
- Сложная система ролей и прав доступа
- Веб-интерфейс для управления
- История изменений шаблонов
- Редактирование существующих шаблонов (только добавление/удаление)

## Decisions

### Decision: Авторизация через переменную окружения
Используем простую проверку Telegram ID из `.env` файла вместо таблицы администраторов в БД.

**Rationale:**
- Минимальная сложность реализации
- Достаточно для одного администратора
- Не требует миграций БД
- Легко изменить ID при необходимости

**Alternatives considered:**
- Таблица `admins` в БД - избыточно для одного пользователя
- Hardcoded ID в коде - плохая практика безопасности

### Decision: Middleware для проверки прав
Создаем переиспользуемый middleware `isAdmin` для всех административных команд.

**Rationale:**
- DRY принцип - проверка в одном месте
- Легко расширить для других админских команд
- Централизованная обработка ошибок доступа

### Decision: Удаление вместо деактивации через команды
Команда `/deletemessage` полностью удаляет шаблон из БД, а не деактивирует.

**Rationale:**
- Проще для администратора (меньше команд)
- Деактивация все еще доступна через прямой доступ к БД при необходимости
- Удаленные шаблоны можно легко добавить заново

**Alternatives considered:**
- Отдельные команды `/activatemessage` и `/deactivatemessage` - усложняет интерфейс

### Decision: Отображение ID шаблонов в списке
Команда `/listmessages` показывает UUID каждого шаблона для использования в `/deletemessage`.

**Rationale:**
- UUID уникальны и неизменны
- Позволяет точно идентифицировать шаблон для удаления
- Не требует дополнительной логики поиска

## Risks / Trade-offs

**Risk:** Единственный администратор может потерять доступ
- **Mitigation:** Доступ к серверу позволяет изменить ADMIN_TELEGRAM_ID в .env

**Risk:** Telegram ID может быть подделан (маловероятно)
- **Mitigation:** Telegram гарантирует уникальность ID, подделка требует компрометации аккаунта

**Trade-off:** Нет истории изменений шаблонов
- **Accepted:** Для текущих требований история не критична, можно добавить позже

**Trade-off:** Нет редактирования существующих шаблонов
- **Accepted:** Удаление + создание нового проще в реализации и достаточно функционально

## Migration Plan

### Локальная разработка
1. Добавить `ADMIN_TELEGRAM_ID=131461909` в `.env` и `.env.example`
2. Обновить `src/config.ts` для чтения новой переменной
3. Создать middleware `src/middleware/isAdmin.ts`
4. Добавить новые команды в `src/handlers/commands.ts`
5. Расширить `messageTemplateService` методами CRUD
6. Обновить команду `/help` для условного отображения админских команд

### Деплой на продакшн
**Сервер:** `ssh root@188.225.38.67`

**Шаги деплоя:**
1. Закоммитить и запушить изменения в репозиторий
2. CI/CD автоматически задеплоит изменения на сервер
3. Подключиться к серверу: `ssh root@188.225.38.67`
4. Добавить `ADMIN_TELEGRAM_ID=131461909` в `.env` файл на сервере
5. Перезапустить бота (если требуется): `docker-compose restart bot`
6. Протестировать команды `/addreminder`, `/addreward`, `/listmessages`

**Rollback:** 
- Локально: удалить новые команды и middleware, откатить изменения в config.ts
- На сервере: откатить через CI/CD или `git revert`, удалить `ADMIN_TELEGRAM_ID` из `.env`

## Open Questions
- Нужно ли логировать административные действия? (Решение: пока нет, можно добавить позже)
- Ограничивать ли длину текста шаблона? (Решение: да, лимит Telegram 4096 символов)
