# Project Context

## Purpose
Telegram бот для управления уведомлениями с возможностью регистрации пользователей, создания уведомлений и просмотра истории. Проект предназначен для демонстрации интеграции grammY с PostgreSQL через Prisma ORM в контейнеризированной среде.

## Tech Stack
- **TypeScript** - основной язык разработки
- **Node.js 18+** - runtime окружение
- **grammY** - современный фреймворк для Telegram Bot API
- **PostgreSQL 16** - реляционная база данных
- **Prisma 5.7** - ORM для работы с базой данных
- **Docker & Docker Compose** - контейнеризация и оркестрация
- **Yarn** - менеджер пакетов
- **tsx** - TypeScript executor для разработки

## Project Conventions

### Code Style
- Не использовать тип `any` - всегда указывать конкретные типы
- Не писать комментарии в коде (код должен быть самодокументируемым)
- Использовать строгий режим TypeScript (`strict: true`)
- Именование переменных: camelCase
- Именование файлов: kebab-case для конфигов, camelCase для TypeScript модулей
- Использовать async/await вместо промисов с .then()
- Предпочитать const над let, избегать var
- Все ответы и документация должны быть на русском языке

### Architecture Patterns
- **Модульная структура**: разделение на `src/`, `prisma/`, конфигурационные файлы
- **Конфигурация через переменные окружения**: все секреты и настройки в `.env`
- **Singleton для Prisma Client**: глобальный экземпляр для избежания множественных подключений
- **Graceful shutdown**: корректная обработка SIGINT/SIGTERM для закрытия соединений
- **Мультистейдж Docker сборка**: оптимизация размера образа через отдельные стадии
- **Database-first подход**: Prisma схема как источник истины для моделей данных

### Testing Strategy
- Пока не реализовано - планируется добавление unit и integration тестов
- Рекомендуется использовать Jest для unit тестов
- Для интеграционных тестов - testcontainers для PostgreSQL
- Тестировать команды бота через моки grammY Context

### Git Workflow
- Использовать conventional commits (feat:, fix:, docs:, refactor:, etc.)
- Основная ветка: `main`
- Feature branches: `feature/описание-фичи`
- Bugfix branches: `fix/описание-бага`
- Коммиты на русском или английском языке
- Pull requests обязательны для изменений в main

## Domain Context

### Telegram Bot API
- Бот взаимодействует с пользователями через команды (начинаются с `/`)
- Каждое сообщение содержит контекст (`ctx`) с информацией о пользователе и чате
- `telegramId` - уникальный идентификатор пользователя в Telegram (BigInt)
- Боты не могут инициировать диалог первыми - только отвечать на сообщения

### База данных
- **User**: хранит информацию о пользователях Telegram
- **Notification**: записи уведомлений, связанные с пользователями
- Используется UUID для первичных ключей
- Каскадное удаление: при удалении пользователя удаляются его уведомления

### Команды бота
- `/start` - регистрация/обновление информации пользователя
- `/notify <сообщение>` - создание нового уведомления
- `/history` - просмотр последних 10 уведомлений

## Important Constraints
- Токен бота должен храниться в переменных окружения, никогда не коммититься в git
- PostgreSQL должен быть доступен до запуска бота (healthcheck в docker-compose)
- Миграции Prisma должны выполняться перед запуском приложения
- Node.js версия >= 18.0.0 обязательна
- Все сообщения пользователям должны быть на русском языке

## External Dependencies

### Telegram Bot API
- Endpoint: `https://api.telegram.org/bot<token>/`
- Используется через grammY библиотеку
- Требуется токен от @BotFather
- Rate limits: ~30 сообщений в секунду на бота

### PostgreSQL
- Версия: 16-alpine
- Порт: 5432 (по умолчанию)
- Требуется для хранения всех данных приложения
- Подключение через Prisma Client

### Docker Hub
- `node:18-alpine` - базовый образ для приложения
- `postgres:16-alpine` - образ базы данных
